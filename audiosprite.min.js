/*!
 * AudioSprite v1.1
 *
 * Copyright 2011, Johannes Koggdal
 * MIT License
 */
(function(a,b,c){var d="ontouchstart"in a||"createTouch"in b,e=function(a,c){var e=this,f,g,h,i=[],j=[],k=[],l,m;c=c||1,c instanceof Array&&(k=c,c=k.length),f=d?1:c;for(g=0;g<f;g++)h=new Audio,h.autobuffer=!0,h.loaded=!1,h.src=a,h.load(),h.userPaused=!1,h.loopSprite=!1,h.addEventListener("ended",function(a,b,c){return function(){c.loopSprite&&b.play(a)}}(g,e,h),!1),i.push(h),j.push(0);this.sounds=i,this.timers=j,this.sprites=k,this.numTracks=f,this.lastCurrentTime=0,this.totalDiff=0,this.diffs=0,this.numSprites=c,l=function(){i[0].play(),i[0].pause(),b.removeEventListener("touchstart",l,!0)},b.addEventListener("touchstart",l,!0)};e.prototype={play:function(a){var b=this,e=this.numTracks===1?this.sounds[0]:this.sounds[a],f=this.numTracks===1?this.timers[0]:this.timers[a],g=e.duration/this.numSprites*1e3,h,i;if(e.readyState!==4&&!d&&!e.loaded||d&&e.seekable&&e.seekable.length===0&&!e.loaded)return setTimeout(function(){b.play(a)},10);e.loaded=!0;if(this.sprites.length===0)for(h=0;h<this.numSprites;h++)this.sprites.push({start:h*g,length:g});i=this.sprites[a],a!==c&&this.numSprites>1&&(e.userPaused||(e.currentTime=i.start/1e3),clearInterval(f),f=setInterval(function(){b.checkTime(a,(i.start+i.length)/1e3)},1),this.numTracks===1?this.timers[0]=f:this.timers[a]=f),e.play(),e.userPaused=!1},pause:function(a){var b=this.numTracks===1?this.sounds[0]:this.sounds[a];b.pause(),b.userPaused=!0},stop:function(a){var b=this.numTracks===1?this.sounds[0]:this.sounds[a];b.pause(),b.currentTime=0,b.loopSprite=!1},loop:function(a){var b=this.numTracks===1?this.sounds[0]:this.sounds[a];b.loopSprite=!0,this.play(a)},checkTime:function(a,b){var c=this,d=this.numTracks===1?this.sounds[0]:this.sounds[a],e=this.numTracks===1?this.timers[0]:this.timers[a],f;this.totalDiff+=d.currentTime-this.lastCurrentTime,this.diffs++,f=this.totalDiff/this.diffs,d.currentTime+f>=b&&(clearInterval(e),setTimeout(function(){d.pause(),d.loopSprite&&c.play(a)},(b-d.currentTime)*1e3))}};var f=function(a,b){typeof a==="string"&&(a=new e(a),b=0),this.sprite=a,this.position=b};f.prototype={play:function(){this.sprite.play(this.position)},pause:function(){this.sprite.pause(this.position)},stop:function(){this.sprite.stop(this.position)},loop:function(){this.sprite.loop(this.position)}},a.AudioSprite=e,a.Sound=f})(window,document)
